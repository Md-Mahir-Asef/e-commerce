generator client {
  provider   = "prisma-client"
  output     = "../src/generated/"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model user {
  user_name  String
  email      String   @unique
  password   String
  created_at DateTime @default(now())
  role       Roles    @default(user)
  id         Int      @id @unique @default(autoincrement())
  cart       Cart?
  orders     Order[]
}

model Product {
  id            Int        @id @unique @default(autoincrement())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  name          String
  description   String?
  price         Int
  rating        Float      @default(5.0)
  discountPrice Int?
  images        String[]
  categories    Category[] @relation("ProductCategories")
  cartItems     CartItem[]

  @@index([name])
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  products Product[] @relation("ProductCategories")
}

enum Roles {
  user
  admin
  visitor
}

model Cart {
  id        Int       @id @default(autoincrement())
  userId    Int       @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      user      @relation(fields: [userId], references: [id])
  items     CartItem[]
}

model CartItem {
  id        Int      @id @default(autoincrement())
  cartId    Int
  productId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cart      Cart     @relation(fields: [cartId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
  
  @@unique([cartId, productId])
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model Order {
  id          Int         @id @unique @default(autoincrement())
  userId      Int
  totalAmount Int
  status      OrderStatus @default(PENDING)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  user        user        @relation(fields: [userId], references: [id])
  items       OrderItem[]
}

model OrderItem {
  id             Int     @id @unique @default(autoincrement())
  orderId        Int
  productId      Int
  quantity       Int
  priceAtOrder   Int
  productSnapshot Json   // Store product details snapshot
  createdAt      DateTime @default(now())
  order          Order   @relation(fields: [orderId], references: [id])
  
  @@unique([orderId, productId])
}
